generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                      String                   @id @default(cuid())
  email                   String                   @unique
  name                    String?
  password                String
  avatarUrl               String?                  @map("avatar_url")
  bio                     String?                  @db.Text
  phone                   String?
  location                String?
  website                 String?
  isActive                Boolean                  @default(true)
  roleId                  String                   @map("role_id")
  createdAt               DateTime                 @default(now()) @map("created_at")
  updatedAt               DateTime                 @updatedAt @map("updated_at")
  authProvider            String                   @default("local") @map("auth_provider")
  emailVerified           Boolean                  @default(false) @map("email_verified")
  twoFactorEnabled        Boolean                  @default(false) @map("two_factor_enabled")
  lastPasswordChange      DateTime?                @map("last_password_change")
  notificationPreferences NotificationPreference[]
  notifications           Notification[]
  tokenBlacklist          TokenBlacklist[]
  role                    UserRole                 @relation(fields: [roleId], references: [id])
  webhookConfigs          WebhookConfig[]
  blogPosts               BlogPost[]
  dashboardLayouts        DashboardLayout[]

  @@index([roleId])
  @@index([email])
  @@map("users")
}

model UserRole {
  id              String           @id @default(cuid())
  name            String           @unique
  description     String?
  isActive        Boolean          @default(true)
  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime         @updatedAt @map("updated_at")
  isSystemRole    Boolean          @default(false) @map("is_system_role")
  rolePermissions RolePermission[]
  users           User[]

  @@map("user_roles")
}

model Permission {
  id              String           @id @default(cuid())
  name            String           @unique
  description     String?
  resource        String
  action          String
  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime         @updatedAt @map("updated_at")
  rolePermissions RolePermission[]

  @@index([resource])
  @@index([action])
  @@map("permissions")
}

model RolePermission {
  id           String     @id @default(cuid())
  roleId       String     @map("role_id")
  permissionId String     @map("permission_id")
  createdAt    DateTime   @default(now()) @map("created_at")
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  role         UserRole   @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([roleId, permissionId])
  @@index([roleId])
  @@index([permissionId])
  @@map("role_permissions")
}

model TokenBlacklist {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String   @map("user_id")
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([expiresAt])
  @@index([userId])
  @@map("token_blacklist")
}

model Settings {
  id           String   @id @default(cuid())
  userId       String?  @unique @map("user_id")
  scope        String   @default("global")
  themeMode    String   @default("system") @map("theme_mode")
  activeTheme  String   @default("default") @map("active_theme")
  lightPalette Json     @map("light_palette")
  darkPalette  Json     @map("dark_palette")
  typography   Json
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@index([userId])
  @@index([scope])
  @@map("settings")
}

model Notification {
  id                 String                    @id @default(cuid())
  userId             String                    @map("user_id")
  title              String
  message            String
  category           NotificationCategory
  priority           NotificationPriority      @default(NORMAL)
  metadata           Json?
  actionUrl          String?                   @map("action_url")
  actionLabel        String?                   @map("action_label")
  imageUrl           String?                   @map("image_url")
  channel            NotificationChannel       @default(IN_APP)
  isRead             Boolean                   @default(false) @map("is_read")
  readAt             DateTime?                 @map("read_at")
  deletedAt          DateTime?                 @map("deleted_at")
  requiredPermission String?                   @map("required_permission")
  createdAt          DateTime                  @default(now()) @map("created_at")
  updatedAt          DateTime                  @updatedAt @map("updated_at")
  scheduledFor       DateTime?                 @map("scheduled_for")
  actions            NotificationAction[]
  deliveryLogs       NotificationDeliveryLog[]
  user               User                      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([category])
  @@index([priority])
  @@index([isRead])
  @@index([createdAt])
  @@index([scheduledFor])
  @@index([userId, isRead, createdAt])
  @@map("notifications")
}

model NotificationPreference {
  id           String               @id @default(cuid())
  userId       String               @map("user_id")
  category     NotificationCategory
  enabled      Boolean              @default(true)
  dndEnabled   Boolean              @default(false) @map("dnd_enabled")
  dndStartTime String?              @map("dnd_start_time")
  dndEndTime   String?              @map("dnd_end_time")
  dndDays      Int[]                @default([]) @map("dnd_days")
  createdAt    DateTime             @default(now()) @map("created_at")
  updatedAt    DateTime             @updatedAt @map("updated_at")
  user         User                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, category])
  @@index([userId])
  @@map("notification_preferences")
}

model NotificationTemplate {
  id              String                @id @default(cuid())
  key             String                @unique
  name            String
  description     String?
  category        NotificationCategory
  title           String
  message         String
  variables       Json
  defaultChannels NotificationChannel[] @default([IN_APP]) @map("default_channels")
  defaultPriority NotificationPriority  @default(NORMAL) @map("default_priority")
  version         Int                   @default(1)
  isActive        Boolean               @default(true) @map("is_active")
  createdAt       DateTime              @default(now()) @map("created_at")
  updatedAt       DateTime              @updatedAt @map("updated_at")

  @@index([key])
  @@index([category])
  @@map("notification_templates")
}

model NotificationDeliveryLog {
  id             String              @id @default(cuid())
  notificationId String              @map("notification_id")
  channel        NotificationChannel
  status         DeliveryStatus      @default(PENDING)
  attempts       Int                 @default(0)
  externalId     String?             @map("external_id")
  errorMessage   String?             @map("error_message")
  errorCode      String?             @map("error_code")
  sentAt         DateTime?           @map("sent_at")
  deliveredAt    DateTime?           @map("delivered_at")
  failedAt       DateTime?           @map("failed_at")
  openedAt       DateTime?           @map("opened_at")
  clickedAt      DateTime?           @map("clicked_at")
  createdAt      DateTime            @default(now()) @map("created_at")
  notification   Notification        @relation(fields: [notificationId], references: [id], onDelete: Cascade)

  @@index([notificationId])
  @@index([channel])
  @@index([status])
  @@map("notification_delivery_logs")
}

model NotificationAction {
  id             String       @id @default(cuid())
  notificationId String       @map("notification_id")
  label          String
  actionType     ActionType   @map("action_type")
  actionUrl      String?      @map("action_url")
  actionMethod   String?      @default("GET") @map("action_method")
  actionPayload  Json?        @map("action_payload")
  variant        String?      @default("default")
  icon           String?
  isExecuted     Boolean      @default(false) @map("is_executed")
  executedAt     DateTime?    @map("executed_at")
  executedBy     String?      @map("executed_by")
  createdAt      DateTime     @default(now()) @map("created_at")
  notification   Notification @relation(fields: [notificationId], references: [id], onDelete: Cascade)

  @@index([notificationId])
  @@map("notification_actions")
}

model WebhookConfig {
  id              String                 @id @default(cuid())
  userId          String?                @map("user_id")
  name            String
  url             String
  secret          String?
  categories      NotificationCategory[] @default([])
  priorities      NotificationPriority[] @default([])
  isActive        Boolean                @default(true) @map("is_active")
  retryAttempts   Int                    @default(3) @map("retry_attempts")
  createdAt       DateTime               @default(now()) @map("created_at")
  updatedAt       DateTime               @updatedAt @map("updated_at")
  lastTriggeredAt DateTime?              @map("last_triggered_at")
  user            User?                  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("webhook_configs")
}

enum NotificationCategory {
  SYSTEM
  USER_ACTION
  SECURITY
  BILLING
  CONTENT
  WORKFLOW
  SOCIAL
  CUSTOM
}

enum NotificationPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum NotificationChannel {
  IN_APP
}

enum DeliveryStatus {
  PENDING
  SENT
  DELIVERED
  FAILED
  OPENED
  CLICKED
}

enum ActionType {
  LINK
  API_CALL
  INLINE_FORM
  DISMISS
}

model BlogPost {
  id              String         @id @default(cuid())
  title           String
  slug            String         @unique
  excerpt         String?
  content         String         @db.Text
  featuredImage   String?        @map("featured_image")
  status          PostStatus     @default(DRAFT)
  publishedAt     DateTime?      @map("published_at")
  authorId        String?        @map("author_id")
  authorName      String?        @map("author_name")
  authorEmail     String?        @map("author_email")
  metaTitle       String?        @map("meta_title")
  metaDescription String?        @map("meta_description")
  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")
  author          User?          @relation(fields: [authorId], references: [id], onDelete: SetNull)
  categories      BlogCategory[]
  tags            BlogTag[]

  @@index([slug])
  @@index([status])
  @@index([publishedAt])
  @@index([authorId])
  @@map("blog_posts")
}

model BlogCategory {
  id          String     @id @default(cuid())
  name        String     @unique
  slug        String     @unique
  description String?
  createdAt   DateTime   @default(now()) @map("created_at")
  posts       BlogPost[]

  @@index([slug])
  @@map("blog_categories")
}

model BlogTag {
  id        String     @id @default(cuid())
  name      String     @unique
  slug      String     @unique
  createdAt DateTime   @default(now()) @map("created_at")
  posts     BlogPost[]

  @@index([slug])
  @@map("blog_tags")
}

enum PostStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

// Landing Page CMS Models

model LandingPageContent {
  id          String    @id @default(cuid())
  sections    Json      @map("sections") // Array of section objects
  settings    Json      @map("settings") // Global settings (theme, layout, SEO)
  version     Int       @default(1)
  isActive    Boolean   @default(true) @map("is_active")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  publishedAt DateTime? @map("published_at")

  @@map("landing_page_content")
}

model CustomPage {
  id               String         @id @default(cuid())
  title            String
  slug             String         @unique
  content          String         @db.Text
  excerpt          String?
  featuredImage    String?        @map("featured_image")
  status           PageStatus     @default(DRAFT)
  visibility       PageVisibility @default(PUBLIC)
  parentPageId     String?        @map("parent_page_id")
  showInNavigation Boolean        @default(false) @map("show_in_navigation")
  displayOrder     Int            @default(0) @map("display_order")
  metaTitle        String?        @map("meta_title")
  metaDescription  String?        @map("meta_description")
  metaKeywords     String?        @map("meta_keywords")
  customCssClass   String?        @map("custom_css_class")
  templateKey      String?        @default("default") @map("template_key")
  createdAt        DateTime       @default(now()) @map("created_at")
  updatedAt        DateTime       @updatedAt @map("updated_at")
  publishedAt      DateTime?      @map("published_at")
  parentPage       CustomPage?    @relation("PageHierarchy", fields: [parentPageId], references: [id], onDelete: SetNull)
  childPages       CustomPage[]   @relation("PageHierarchy")
  redirectsFrom    PageRedirect[] @relation("RedirectTo")

  @@index([slug])
  @@index([status])
  @@index([visibility])
  @@index([parentPageId])
  @@index([showInNavigation, displayOrder])
  @@index([publishedAt])
  @@map("custom_pages")
}

model PageRedirect {
  id           String     @id @default(cuid())
  fromSlug     String     @unique @map("from_slug")
  toPageId     String     @map("to_page_id")
  redirectType Int        @default(301) @map("redirect_type")
  createdAt    DateTime   @default(now()) @map("created_at")
  toPage       CustomPage @relation("RedirectTo", fields: [toPageId], references: [id], onDelete: Cascade)

  @@index([fromSlug])
  @@index([toPageId])
  @@map("page_redirects")
}

enum PageStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum PageVisibility {
  PUBLIC
  PRIVATE
}

// E-Commerce Models

model Customer {
  id              String           @id @default(cuid())
  email           String           @unique
  firstName       String           @map("first_name")
  lastName        String           @map("last_name")
  phone           String?
  company         String?
  shippingAddress Json?            @map("shipping_address")
  billingAddress  Json?            @map("billing_address")
  notes           String?          @db.Text
  tags            String[]         @default([])
  portalToken     String?          @unique @map("portal_token")
  portalExpiresAt DateTime?        @map("portal_expires_at")
  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime         @updatedAt @map("updated_at")
  lastOrderAt     DateTime?        @map("last_order_at")
  orders          Order[]
  account         CustomerAccount?

  @@index([email])
  @@index([portalToken])
  @@index([createdAt])
  @@map("customers")
}

model Product {
  id               String            @id @default(cuid())
  name             String
  slug             String            @unique
  description      String?           @db.Text
  shortDescription String?           @map("short_description")
  basePrice        Decimal           @map("base_price") @db.Decimal(10, 2)
  compareAtPrice   Decimal?          @map("compare_at_price") @db.Decimal(10, 2)
  cost             Decimal?          @db.Decimal(10, 2)
  sku              String?           @unique
  barcode          String?
  featuredImage    String?           @map("featured_image")
  images           String[]          @default([])
  status           ProductStatus     @default(DRAFT)
  isVisible        Boolean           @default(true) @map("is_visible")
  isFeatured       Boolean           @default(false) @map("is_featured")
  metaTitle        String?           @map("meta_title")
  metaDescription  String?           @map("meta_description")
  createdAt        DateTime          @default(now()) @map("created_at")
  updatedAt        DateTime          @updatedAt @map("updated_at")
  publishedAt      DateTime?         @map("published_at")
  categories       ProductCategory[]
  tags             ProductTag[]
  variants         ProductVariant[]
  orderItems       OrderItem[]
  cartItems        CartItem[]
  wishlistItems    WishlistItem[]

  @@index([slug])
  @@index([status])
  @@index([isFeatured])
  @@map("products")
}

model ProductCategory {
  id           String            @id @default(cuid())
  name         String            @unique
  slug         String            @unique
  description  String?
  parentId     String?           @map("parent_id")
  displayOrder Int               @default(0) @map("display_order")
  isVisible    Boolean           @default(true) @map("is_visible")
  image        String?
  createdAt    DateTime          @default(now()) @map("created_at")
  updatedAt    DateTime          @updatedAt @map("updated_at")
  parent       ProductCategory?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children     ProductCategory[] @relation("CategoryHierarchy")
  products     Product[]

  @@index([slug])
  @@index([parentId])
  @@map("product_categories")
}

model ProductTag {
  id        String    @id @default(cuid())
  name      String    @unique
  slug      String    @unique
  createdAt DateTime  @default(now()) @map("created_at")
  products  Product[]

  @@index([slug])
  @@map("product_tags")
}

model ProductVariant {
  id             String         @id @default(cuid())
  productId      String         @map("product_id")
  name           String
  sku            String?        @unique
  barcode        String?
  attributes     Json
  price          Decimal?       @db.Decimal(10, 2)
  compareAtPrice Decimal?       @map("compare_at_price") @db.Decimal(10, 2)
  cost           Decimal?       @db.Decimal(10, 2)
  image          String?
  isActive       Boolean        @default(true) @map("is_active")
  createdAt      DateTime       @default(now()) @map("created_at")
  updatedAt      DateTime       @updatedAt @map("updated_at")
  product        Product        @relation(fields: [productId], references: [id], onDelete: Cascade)
  inventory      Inventory?
  orderItems     OrderItem[]
  cartItems      CartItem[]
  wishlistItems  WishlistItem[]

  @@index([productId])
  @@index([sku])
  @@map("product_variants")
}

model Inventory {
  id                String                @id @default(cuid())
  productVariantId  String                @unique @map("product_variant_id")
  quantity          Int                   @default(0)
  reserved          Int                   @default(0)
  available         Int                   @default(0)
  lowStockThreshold Int                   @default(10) @map("low_stock_threshold")
  trackInventory    Boolean               @default(true) @map("track_inventory")
  allowBackorder    Boolean               @default(false) @map("allow_backorder")
  createdAt         DateTime              @default(now()) @map("created_at")
  updatedAt         DateTime              @updatedAt @map("updated_at")
  lastRestockedAt   DateTime?             @map("last_restocked_at")
  productVariant    ProductVariant        @relation(fields: [productVariantId], references: [id], onDelete: Cascade)
  adjustments       InventoryAdjustment[]

  @@index([productVariantId])
  @@map("inventory")
}

model InventoryAdjustment {
  id             String    @id @default(cuid())
  inventoryId    String    @map("inventory_id")
  quantityChange Int       @map("quantity_change")
  reason         String
  notes          String?   @db.Text
  userId         String?   @map("user_id")
  createdAt      DateTime  @default(now()) @map("created_at")
  inventory      Inventory @relation(fields: [inventoryId], references: [id], onDelete: Cascade)

  @@index([inventoryId])
  @@index([createdAt])
  @@map("inventory_adjustments")
}

model Order {
  id                String               @id @default(cuid())
  orderNumber       String               @unique @map("order_number")
  customerId        String               @map("customer_id")
  status            OrderStatus          @default(PENDING)
  paymentStatus     PaymentStatus        @default(PENDING) @map("payment_status")
  fulfillmentStatus FulfillmentStatus    @default(UNFULFILLED) @map("fulfillment_status")
  subtotal          Decimal              @db.Decimal(10, 2)
  tax               Decimal              @default(0) @db.Decimal(10, 2)
  shipping          Decimal              @default(0) @db.Decimal(10, 2)
  discount          Decimal              @default(0) @db.Decimal(10, 2)
  total             Decimal              @db.Decimal(10, 2)
  shippingAddress   Json                 @map("shipping_address")
  billingAddress    Json                 @map("billing_address")
  shippingMethodId  String?              @map("shipping_method_id")
  trackingNumber    String?              @map("tracking_number")
  customerEmail     String               @map("customer_email")
  customerName      String               @map("customer_name")
  customerPhone     String?              @map("customer_phone")
  customerNotes     String?              @map("customer_notes") @db.Text
  internalNotes     String?              @map("internal_notes") @db.Text
  createdAt         DateTime             @default(now()) @map("created_at")
  updatedAt         DateTime             @updatedAt @map("updated_at")
  paidAt            DateTime?            @map("paid_at")
  shippedAt         DateTime?            @map("shipped_at")
  deliveredAt       DateTime?            @map("delivered_at")
  cancelledAt       DateTime?            @map("cancelled_at")
  customer          Customer             @relation(fields: [customerId], references: [id])
  items             OrderItem[]
  statusHistory     OrderStatusHistory[]
  shippingMethod    ShippingMethod?      @relation(fields: [shippingMethodId], references: [id])

  @@index([customerId])
  @@index([orderNumber])
  @@index([status])
  @@index([createdAt])
  @@map("orders")
}

model OrderItem {
  id               String          @id @default(cuid())
  orderId          String          @map("order_id")
  productId        String          @map("product_id")
  productVariantId String?         @map("product_variant_id")
  productName      String          @map("product_name")
  variantName      String?         @map("variant_name")
  sku              String?
  quantity         Int
  unitPrice        Decimal         @map("unit_price") @db.Decimal(10, 2)
  totalPrice       Decimal         @map("total_price") @db.Decimal(10, 2)
  createdAt        DateTime        @default(now()) @map("created_at")
  order            Order           @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product          Product         @relation(fields: [productId], references: [id])
  productVariant   ProductVariant? @relation(fields: [productVariantId], references: [id])

  @@index([orderId])
  @@index([productId])
  @@map("order_items")
}

model OrderStatusHistory {
  id         String       @id @default(cuid())
  orderId    String       @map("order_id")
  fromStatus OrderStatus? @map("from_status")
  toStatus   OrderStatus  @map("to_status")
  userId     String?      @map("user_id")
  notes      String?      @db.Text
  createdAt  DateTime     @default(now()) @map("created_at")
  order      Order        @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([createdAt])
  @@map("order_status_history")
}

model ShippingMethod {
  id          String   @id @default(cuid())
  name        String
  description String?
  price       Decimal  @db.Decimal(10, 2)
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  orders      Order[]

  @@map("shipping_methods")
}

enum ProductStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}

enum FulfillmentStatus {
  UNFULFILLED
  PARTIALLY_FULFILLED
  FULFILLED
}

model EcommerceSettings {
  id                      String   @id @default(cuid())
  scope                   String   @default("global") // 'global' or 'user'
  userId                  String?  @unique @map("user_id")
  storeName               String   @default("My Store") @map("store_name")
  storeDescription        String?  @map("store_description")
  currency                String   @default("USD")
  currencySymbol          String   @default("$") @map("currency_symbol")
  taxRate                 Decimal  @default(0) @db.Decimal(5, 2)
  taxLabel                String   @default("Tax") @map("tax_label")
  shippingEnabled         Boolean  @default(true) @map("shipping_enabled")
  portalEnabled           Boolean  @default(true) @map("portal_enabled")
  allowGuestCheckout      Boolean  @default(false) @map("allow_guest_checkout")
  trackInventory          Boolean  @default(true) @map("track_inventory")
  lowStockThreshold       Int      @default(10) @map("low_stock_threshold")
  autoGenerateOrderNumbers Boolean @default(true) @map("auto_generate_order_numbers")
  orderNumberPrefix       String   @default("ORD") @map("order_number_prefix")
  codEnabled              Boolean  @default(true) @map("cod_enabled")
  codFee                  Decimal  @default(0) @db.Decimal(10, 2) @map("cod_fee")
  codMinOrderAmount       Decimal  @default(0) @db.Decimal(10, 2) @map("cod_min_order_amount")
  codMaxOrderAmount       Decimal? @db.Decimal(10, 2) @map("cod_max_order_amount")
  codAvailableCountries   String[] @default([]) @map("cod_available_countries")
  createdAt               DateTime @default(now()) @map("created_at")
  updatedAt               DateTime @updatedAt @map("updated_at")

  @@index([scope])
  @@index([userId])
  @@map("ecommerce_settings")
}

// Storefront Models

model Cart {
  id              String           @id @default(cuid())
  sessionId       String?          @unique @map("session_id") // For guest users
  userId          String?          @map("user_id") // For logged-in users
  expiresAt       DateTime         @map("expires_at") // Auto-cleanup abandoned carts
  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime         @updatedAt @map("updated_at")
  items           CartItem[]
  customerAccount CustomerAccount? @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@index([userId])
  @@index([expiresAt])
  @@map("carts")
}

model CartItem {
  id               String          @id @default(cuid())
  cartId           String          @map("cart_id")
  productId        String          @map("product_id")
  productVariantId String?         @map("product_variant_id")
  quantity         Int             @default(1)
  priceSnapshot    Decimal         @map("price_snapshot") @db.Decimal(10, 2) // Price at time of adding to cart
  createdAt        DateTime        @default(now()) @map("created_at")
  updatedAt        DateTime        @updatedAt @map("updated_at")
  cart             Cart            @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product          Product         @relation(fields: [productId], references: [id])
  productVariant   ProductVariant? @relation(fields: [productVariantId], references: [id])

  @@unique([cartId, productId, productVariantId])
  @@index([cartId])
  @@index([productId])
  @@map("cart_items")
}

model Wishlist {
  id              String          @id @default(cuid())
  userId          String          @unique @map("user_id")
  createdAt       DateTime        @default(now()) @map("created_at")
  updatedAt       DateTime        @updatedAt @map("updated_at")
  items           WishlistItem[]
  customerAccount CustomerAccount @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("wishlists")
}

model WishlistItem {
  id               String          @id @default(cuid())
  wishlistId       String          @map("wishlist_id")
  productId        String          @map("product_id")
  productVariantId String?         @map("product_variant_id")
  createdAt        DateTime        @default(now()) @map("created_at")
  wishlist         Wishlist        @relation(fields: [wishlistId], references: [id], onDelete: Cascade)
  product          Product         @relation(fields: [productId], references: [id])
  productVariant   ProductVariant? @relation(fields: [productVariantId], references: [id])

  @@unique([wishlistId, productId, productVariantId])
  @@index([wishlistId])
  @@index([productId])
  @@map("wishlist_items")
}

model CustomerAccount {
  id            String    @id @default(cuid())
  customerId    String    @unique @map("customer_id")
  email         String    @unique
  password      String
  emailVerified Boolean   @default(false) @map("email_verified")
  lastLogin     DateTime? @map("last_login")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  customer      Customer  @relation(fields: [customerId], references: [id], onDelete: Cascade)
  carts         Cart[]
  wishlist      Wishlist?

  @@index([email])
  @@index([customerId])
  @@map("customer_accounts")
}

model PaymentMethod {
  id            String   @id @default(cuid())
  name          String
  type          String
  description   String?
  isActive      Boolean  @default(true) @map("is_active")
  displayOrder  Int      @default(0) @map("display_order")
  configuration Json?
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  @@map("payment_methods")
}

// Dashboard Customization System Models

model WidgetDefinition {
  id               String           @id @default(cuid())
  key              String           @unique
  name             String
  description      String
  component        String
  category         String
  icon             String
  defaultGridSpan  Int              @default(6) @map("default_grid_span")
  minGridSpan      Int              @default(3) @map("min_grid_span")
  maxGridSpan      Int              @default(12) @map("max_grid_span")
  configSchema     Json             @map("config_schema")
  dataRequirements Json             @map("data_requirements")
  useCases         String[]         @default([]) @map("use_cases")
  examples         Json[]           @default([])
  tags             String[]         @default([])
  isActive         Boolean          @default(true) @map("is_active")
  isSystemWidget   Boolean          @default(false) @map("is_system_widget")
  createdAt        DateTime         @default(now()) @map("created_at")
  updatedAt        DateTime         @updatedAt @map("updated_at")
  widgetInstances  WidgetInstance[]

  @@index([key])
  @@index([category])
  @@index([isActive])
  @@map("widget_definitions")
}

model DashboardLayout {
  id              String           @id @default(cuid())
  pageId          String           @map("page_id")
  userId          String?          @map("user_id")
  scope           String           @default("global")
  name            String
  description     String?
  isActive        Boolean          @default(true) @map("is_active")
  isDefault       Boolean          @default(false) @map("is_default")
  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime         @updatedAt @map("updated_at")
  user            User?            @relation(fields: [userId], references: [id], onDelete: Cascade)
  widgetInstances WidgetInstance[]

  @@unique([pageId, userId])
  @@index([pageId])
  @@index([userId])
  @@index([scope])
  @@index([isDefault])
  @@map("dashboard_layouts")
}

model WidgetInstance {
  id               String           @id @default(cuid())
  layoutId         String           @map("layout_id")
  widgetKey        String           @map("widget_key")
  position         Int
  gridSpan         Int              @default(6) @map("grid_span")
  gridRow          Int?             @map("grid_row")
  config           Json
  isVisible        Boolean          @default(true) @map("is_visible")
  createdAt        DateTime         @default(now()) @map("created_at")
  updatedAt        DateTime         @updatedAt @map("updated_at")
  layout           DashboardLayout  @relation(fields: [layoutId], references: [id], onDelete: Cascade)
  widgetDefinition WidgetDefinition @relation(fields: [widgetKey], references: [key])

  @@index([layoutId])
  @@index([widgetKey])
  @@index([position])
  @@map("widget_instances")
}

// Dynamic Menu Management System Models

model DashboardMenu {
  id                  String         @id @default(cuid())
  key                 String         @unique
  label               String
  icon                String
  route               String
  order               Int
  parentId            String?        @map("parent_id")
  pageType            PageType       @map("page_type")
  pageIdentifier      String?        @map("page_identifier")
  componentPath       String?        @map("component_path")
  isActive            Boolean        @default(true) @map("is_active")
  requiredPermissions String[]       @default([]) @map("required_permissions")
  requiredRoles       String[]       @default([]) @map("required_roles")
  featureFlag         String?        @map("feature_flag")
  description         String?
  badge               String?
  availableWidgets    String[]       @default([]) @map("available_widgets")
  createdAt           DateTime       @default(now()) @map("created_at")
  updatedAt           DateTime       @updatedAt @map("updated_at")
  parent              DashboardMenu? @relation("MenuHierarchy", fields: [parentId], references: [id], onDelete: SetNull)
  children            DashboardMenu[] @relation("MenuHierarchy")

  @@index([key])
  @@index([isActive])
  @@index([order])
  @@index([parentId])
  @@map("dashboard_menus")
}

enum PageType {
  WIDGET_BASED
  HARDCODED
  CUSTOM
  EXTERNAL
}
