# Blog Post Excerpt Auto-Generation

## Overview

The blog system includes automatic excerpt generation that extracts a summary from blog post content when an excerpt is not manually provided. This feature strips markdown formatting and intelligently truncates content to create clean, readable excerpts for blog listings.

## Features

### 1. Automatic Excerpt Generation

When creating or updating a blog post without providing an excerpt, the system automatically:
- Extracts text from the content
- Strips all markdown formatting
- Truncates to 200 characters (default)
- Ensures truncation at word boundaries
- Adds ellipsis (...) if truncated

### 2. Manual Override

Users can always provide a custom excerpt that will be used instead of auto-generation:
- Custom excerpts are stored as-is
- No automatic processing applied to manual excerpts
- Maximum length: 500 characters (validated)

### 3. Markdown Stripping

The excerpt generator removes all markdown formatting:
- **Headers**: `# ## ###`
- **Bold**: `**text**` or `__text__`
- **Italic**: `*text*` or `_text_`
- **Links**: `[text](url)` → keeps text only
- **Images**: `![alt](url)` → removed completely
- **Code blocks**: ` ```code``` ` → removed
- **Inline code**: `` `code` `` → keeps text only
- **Blockquotes**: `> text` → keeps text only
- **Lists**: `- item` or `1. item` → keeps text only
- **HTML tags**: `<tag>` → removed

### 4. Smart Truncation

The truncation algorithm:
1. Strips markdown formatting first
2. Checks if content is shorter than max length
3. If longer, truncates to max length
4. Finds last space to avoid cutting words
5. Adds ellipsis (...) to indicate truncation

## Usage

### Backend

#### Creating a Post

```typescript
// Without excerpt - auto-generated
await blogService.create({
  title: 'My Blog Post',
  content: '**This is** the content with *markdown*...',
  // excerpt not provided - will be auto-generated
});

// With custom excerpt - used as-is
await blogService.create({
  title: 'My Blog Post',
  content: '**This is** the content...',
  excerpt: 'Custom excerpt that will be used',
});
```

#### Updating a Post

```typescript
// Update content without excerpt - auto-generates new excerpt
await blogService.update(postId, {
  content: 'Updated content...',
  // excerpt not provided - will be auto-generated from new content
});

// Update with custom excerpt - uses custom excerpt
await blogService.update(postId, {
  content: 'Updated content...',
  excerpt: 'Custom updated excerpt',
});
```

#### Preview Excerpt

```typescript
// Get preview of auto-generated excerpt
const preview = blogService.previewExcerpt(content, 200);
// Returns: { excerpt, characterCount, maxLength, isAutoGenerated }
```

### Frontend

#### BlogEditor Component

The BlogEditor automatically shows:
- Preview of auto-generated excerpt when no custom excerpt provided
- "Generate from content" button to manually trigger generation
- Character count for custom excerpts
- Visual indication of auto-generation vs custom excerpt

```typescript
import { generateExcerpt } from '@/lib/excerpt-utils';

// Generate excerpt from content
const excerpt = generateExcerpt(content, 200);

// Get preview with metadata
const preview = getExcerptPreview(content, 200);
// Returns: { excerpt, isAutoGenerated, characterCount, isTruncated }
```

## API Endpoints

### Preview Excerpt

**Endpoint**: `POST /blog/preview-excerpt`

**Permission**: `blog:write`

**Request Body**:
```json
{
  "content": "Blog post content with **markdown**...",
  "maxLength": 200
}
```

**Response**:
```json
{
  "excerpt": "Blog post content with markdown...",
  "characterCount": 35,
  "maxLength": 200,
  "isAutoGenerated": true
}
```

## Configuration

### Character Limits

**Default Excerpt Length**: 200 characters
- Configurable per request
- Minimum: 50 characters
- Maximum: 500 characters

**Validation**:
- Custom excerpts: max 500 characters
- Auto-generated excerpts: default 200 characters

### Customization

To change the default excerpt length:

**Backend**:
```typescript
// In blog.service.ts
const finalExcerpt = excerpt || generateExcerpt(content, 300); // Custom length
```

**Frontend**:
```typescript
// In excerpt-utils.ts
export const DEFAULT_EXCERPT_LENGTH = 300; // Change default
```

## Examples

### Example 1: Simple Text

**Input**:
```markdown
This is a simple blog post about web development. It covers various topics including React, Next.js, and TypeScript.
```

**Output** (50 chars):
```
This is a simple blog post about web...
```

### Example 2: Markdown Content

**Input**:
```markdown
# Introduction

This is **bold text** and *italic text* with a [link](https://example.com).

- List item 1
- List item 2

More content here.
```

**Output** (100 chars):
```
Introduction This is bold text and italic text with a link. List item 1 List item 2 More content...
```

### Example 3: Code Blocks

**Input**:
```markdown
Here's how to use React hooks:

```javascript
const [count, setCount] = useState(0);
```

This is a simple example of state management.
```

**Output** (100 chars):
```
Here's how to use React hooks: This is a simple example of state management.
```

## Testing

### Backend Tests

Run excerpt generator tests:
```bash
cd backend
npm test excerpt-generator.spec.ts
```

**Test Coverage**:
- Markdown stripping (11 tests)
- Excerpt generation (7 tests)
- Length validation (3 tests)
- Preview generation (3 tests)

### Frontend Tests

Run excerpt utils tests:
```bash
cd frontend
npm test excerpt-utils.test.ts
```

**Test Coverage**:
- Markdown stripping (10 tests)
- Excerpt generation (6 tests)
- Length validation (3 tests)
- Preview generation (3 tests)

## Best Practices

### For Content Creators

1. **Let it auto-generate**: For most posts, the auto-generated excerpt works well
2. **Customize when needed**: Provide custom excerpt for:
   - Posts with complex formatting
   - Posts where first 200 chars aren't representative
   - Posts requiring specific SEO descriptions
3. **Keep it concise**: Custom excerpts should be 150-200 characters
4. **Avoid markdown**: Custom excerpts are displayed as-is

### For Developers

1. **Don't modify auto-generated excerpts**: Let the system handle it
2. **Validate custom excerpts**: Ensure they're within length limits
3. **Test with various content**: Test with different markdown patterns
4. **Consider SEO**: Excerpts are used in meta descriptions

## Troubleshooting

### Excerpt Not Generating

**Issue**: Excerpt field is empty after saving

**Solution**:
- Check that content field has text
- Verify excerpt field is not explicitly set to empty string
- Check backend logs for errors

### Excerpt Too Long

**Issue**: Auto-generated excerpt exceeds expected length

**Solution**:
- Default is 200 chars + "..." (203 total)
- Adjust `DEFAULT_EXCERPT_LENGTH` if needed
- Ensure truncation at word boundary is working

### Markdown Not Stripped

**Issue**: Markdown formatting appears in excerpt

**Solution**:
- Check `stripMarkdown()` function
- Verify regex patterns are correct
- Test with specific markdown pattern causing issue

### Preview Not Showing

**Issue**: Preview doesn't appear in BlogEditor

**Solution**:
- Ensure content field has text
- Check that excerpt field is empty
- Verify `generateExcerpt()` import is correct

## Future Enhancements

Potential improvements:
- [ ] Configurable excerpt length per post
- [ ] Multiple excerpt lengths (short, medium, long)
- [ ] AI-powered excerpt generation
- [ ] Excerpt templates
- [ ] Language-specific truncation rules
- [ ] Excerpt A/B testing
- [ ] SEO score for excerpts

## Related Files

**Backend**:
- `backend/src/blog/utils/excerpt-generator.ts` - Core utility
- `backend/src/blog/blog.service.ts` - Service integration
- `backend/src/blog/blog.controller.ts` - API endpoint
- `backend/src/blog/utils/__tests__/excerpt-generator.spec.ts` - Tests

**Frontend**:
- `frontend/src/lib/excerpt-utils.ts` - Frontend utility
- `frontend/src/components/blog/BlogEditor.tsx` - Editor integration
- `frontend/src/components/blog/BlogCard.tsx` - Display component
- `frontend/src/lib/__tests__/excerpt-utils.test.ts` - Tests

## References

- Requirement 5.5: "THE Blog_System SHALL automatically generate excerpts if not manually provided"
- Design Doc: `.kiro/specs/landing-page-blog-system/design.md`
- Tasks: `.kiro/specs/landing-page-blog-system/tasks.md` (Task 9)
